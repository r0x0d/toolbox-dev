on:
  push:
    branches:
      - main
    paths:
      - 'toolbox/**'
      - '.github/workflows/toolbox.yml'
  schedule:
    - cron:  '0 0 * * MON'
  workflow_dispatch:

permissions: 
    id-token: write
    contents: read

jobs:
  build-base:
    uses: ./.github/workflows/build-image.yml
    with:
      context: .
      image: toolbox-base
      containerfile: toolbox/base.Containerfile
    secrets: inherit

  build-dev:
    name: Build Dev Toolbox (${{ matrix.name }})
    needs: build-base
    strategy:
      matrix:
        include:
          - name: python
            containerfile: toolbox/python.Containerfile
            image: toolbox-python
          - name: node
            containerfile: toolbox/node.Containerfile
            image: toolbox-node
    uses: ./.github/workflows/build-image.yml
    with:
      context: .
      image: ${{ matrix.image }}
      containerfile: ${{ matrix.containerfile }}
    secrets: inherit
